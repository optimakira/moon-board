<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ğŸŒ’</title>
    <style>
      /* ãƒšãƒ¼ã‚¸å…¨ä½“ã®åŸºæœ¬è¨­å®š */
      body {
        /* ãƒ•ã‚©ãƒ³ãƒˆã®ç¨®é¡ï¼ˆè‹±å­—ãƒ»å’Œæ–‡ã®å„ªå…ˆé †ä½ï¼‰ */
        font-family:
          "Helvetica Neue", Arial, "Hiragino Kaku Gothic ProN", sans-serif;
        /* èƒŒæ™¯è‰²ï¼ˆè–„ã„ã‚°ãƒ¬ãƒ¼ï¼‰ */
        background: #f0f0f2;
        /* ç”»é¢ç«¯ã®ä½™ç™½ */
        padding: 20px;
        /* æ–‡å­—è‰²ï¼ˆæ¿ƒã„ã‚°ãƒ¬ãƒ¼ï¼‰ */
        color: #333;
      }

      /* ãƒ˜ãƒƒãƒ€ãƒ¼å…¨ä½“ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã‚„ãƒŠãƒ“ã‚’å›²ã‚€å¤–æ ï¼‰ */
      .header {
        display: flex; /* å­è¦ç´ ã‚’ä¸¦ã¹ã‚‹ï¼ˆFlexboxï¼‰ */
        flex-direction: column; /* è¦ç´ ã‚’ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
        align-items: center; /* ä¸­å¤®æƒãˆ */
        gap: 20px; /* è¦ç´ åŒå£«ã®é–“éš” */
        margin-bottom: 25px; /* ä¸‹æ–¹å‘ã¸ã®ä½™ç™½ */
      }

      /* ã‚¿ã‚¤ãƒˆãƒ«éƒ¨åˆ†ã®è¦‹å‡ºã—è¨­å®š */
      .title-area h1 {
        font-size: 1.8rem; /* æ–‡å­—ã®å¤§ãã• */
        margin: 0; /* æ¨™æº–ã®ä½™ç™½ã‚’ãƒªã‚»ãƒƒãƒˆ */
      }
      /* å¹´è¡¨ç¤ºãªã©ã®è£œåŠ©ãƒ†ã‚­ã‚¹ãƒˆ */
      .year-display {
        font-size: 1rem; /* æ–‡å­—ã®å¤§ãã• */
        color: #888; /* æ–‡å­—è‰²ï¼ˆè–„ã„ã‚°ãƒ¬ãƒ¼ï¼‰ */
        font-weight: normal; /* æ–‡å­—ã®å¤ªã•ã‚’æ¨™æº–ã« */
      }

      /* æ“ä½œãƒ‘ãƒãƒ«ï¼ˆã‚³ãƒ³ã‚½ãƒ¼ãƒ«ï¼‰ã®ã‚«ãƒ¼ãƒ‰å‹ãƒ‡ã‚¶ã‚¤ãƒ³ */
      .nav-console {
        display: flex; /* å­è¦ç´ ã‚’ä¸¦ã¹ã‚‹ */
        flex-direction: column; /* ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
        align-items: center; /* ä¸­å¤®æƒãˆ */
        gap: 15px; /* ä¸­ã®è¦ç´ ã®é–“éš” */
        background: #fff; /* èƒŒæ™¯ã‚’ç™½ã« */
        padding: 15px 30px; /* å†…å´ã®ä½™ç™½ï¼ˆä¸Šä¸‹15pxã€å·¦å³30pxï¼‰ */
        border-radius: 16px; /* è§’ã‚’ä¸¸ãã™ã‚‹ */
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1); /* æµ®ãå‡ºã¦è¦‹ãˆã‚‹å½±ã®åŠ¹æœ */
        border: 1px solid rgba(0, 0, 0, 0.05); /* ã”ãè–„ã„å¢ƒç•Œç·š */
        width: fit-content; /* å¹…ã‚’ä¸­èº«ã®å¤§ãã•ã«åˆã‚ã›ã‚‹ */
      }

      /* é¸æŠãƒ¡ãƒ‹ãƒ¥ãƒ¼ãªã©ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ– */
      .jump-group {
        display: flex; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        gap: 8px; /* è¦ç´ é–“ã®éš™é–“ */
        align-items: center; /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
      }

      /* ã‚»ãƒ¬ã‚¯ãƒˆãƒœãƒƒã‚¯ã‚¹ï¼ˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ï¼‰ã®è£…é£¾ */
      select {
        padding: 6px 12px; /* å†…å´ã®ä½™ç™½ */
        border-radius: 6px; /* è§’ã®ä¸¸ã¿ */
        border: 1px solid #ddd; /* æ ç·šã®è‰² */
        background: #fff; /* èƒŒæ™¯è‰² */
        font-size: 1rem; /* æ–‡å­—ã‚µã‚¤ã‚º */
        cursor: pointer; /* ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸæ™‚ã«æŒ‡ãƒãƒ¼ã‚¯ã«ã™ã‚‹ */
      }

      /* ãƒœã‚¿ãƒ³ã‚’ã¾ã¨ã‚ã‚‹ã‚¨ãƒªã‚¢ */
      .controls {
        display: flex; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        align-items: center; /* ä¸­å¤®æƒãˆ */
        gap: 10px; /* ãƒœã‚¿ãƒ³åŒå£«ã®éš™é–“ */
      }

      /* ãƒœã‚¿ãƒ³ã®åŸºæœ¬ãƒ‡ã‚¶ã‚¤ãƒ³ */
      button {
        padding: 8px 16px; /* å†…å´ã®ä½™ç™½ */
        cursor: pointer; /* æŒ‡ãƒãƒ¼ã‚¯ã«ã™ã‚‹ */
        border-radius: 8px; /* è§’ã®ä¸¸ã¿ */
        border: 1px solid #eee; /* è–„ã„æ ç·š */
        background: #f8f9fa; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
        font-size: 0.85rem; /* æ–‡å­—ã‚µã‚¤ã‚º */
        font-weight: bold; /* æ–‡å­—ã‚’å¤ªå­—ã« */
        color: #444; /* æ–‡å­—è‰² */
      }

      /* ãƒœã‚¿ãƒ³ã«ãƒã‚¦ã‚¹ã‚’ä¹—ã›ãŸæ™‚ã®åå¿œï¼ˆãƒ›ãƒãƒ¼ï¼‰ */
      button:hover {
        background: #7a82f0; /* èƒŒæ™¯ã‚’é’ç´«è‰²ã« */
        color: white; /* æ–‡å­—ã‚’ç™½ã« */
        border-color: #7a82f0; /* æ ç·šã‚‚é’ç´«è‰²ã« */
      }

      /* ä¸‹éƒ¨ã®æ³¨é‡ˆãƒ»æƒ…å ±ã‚¨ãƒªã‚¢ */
      .info {
        font-size: 0.85rem; /* å°ã•ã‚ã®æ–‡å­— */
        color: #666; /* ä¸­é–“ã®ã‚°ãƒ¬ãƒ¼ */
        padding-top: 10px; /* ä¸Šå´ã«ä½™ç™½ */
        border-top: 1px solid #eee; /* åŒºåˆ‡ã‚Šç·š */
        width: 100%; /* æ¨ªå¹…ã„ã£ã±ã„ */
        text-align: center; /* æ–‡å­—ã‚’ä¸­å¤®å¯„ã› */
      }

      /* ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼å…¨ä½“ã®ã‚°ãƒªãƒƒãƒ‰è¨­å®šï¼ˆè¦ªè¦ç´ ï¼‰ */
      .planner-grid {
        display: grid; /* ã‚°ãƒªãƒƒãƒ‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æœ‰åŠ¹åŒ– */
        /* åŸºæœ¬ã®åˆ—è¨­å®šï¼šæœ€ä½160pxå¹…ã§ã€ç”»é¢ã«åˆã‚ã›ã¦è‡ªå‹•ã§è©°ã‚è¾¼ã‚€ */
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        row-gap: 18px; /* è¡Œã®é–“éš”ï¼ˆä¸Šä¸‹ï¼‰ */
        column-gap: 12px; /* åˆ—ã®é–“éš”ï¼ˆå·¦å³ï¼‰ */
        max-width: 1500px; /* æœ€å¤§å¹…ã‚’åˆ¶é™ */
        margin: 0 auto; /* ä¸­å¤®å¯„ã› */
        padding: 5px; /* å†…å´ã®ä½™ç™½ */
        box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å«ã‚ãŸã‚µã‚¤ã‚ºè¨ˆç®— */
      }

      /* ç”»é¢å¹…ã«å¿œã˜ãŸåˆ—æ•°ã®æŒ‡å®šï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ï¼‰ */
      @media (max-width: 599px) {
        .planner-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      } /* ã‚¹ãƒãƒ›ï¼š2åˆ— */
      @media (min-width: 600px) {
        .planner-grid {
          grid-template-columns: repeat(3, 1fr);
        }
      } /* ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆï¼š3åˆ— */
      @media (min-width: 900px) {
        .planner-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      } /* PCï¼ˆå°ï¼‰ï¼š4åˆ— */
      @media (min-width: 1200px) {
        .planner-grid {
          grid-template-columns: repeat(6, 1fr);
        }
      } /* PCï¼ˆå¤§ï¼‰ï¼š6åˆ— */

      /* ã‚°ãƒªãƒƒãƒ‰ã®æœ€åˆã®è¦ç´ ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚„ä»Šæœˆã®ç›®æ¨™ãªã©ï¼‰ã‚’æ¨ªã„ã£ã±ã„ã«åºƒã’ã‚‹ */
      .planner-grid > div:first-child {
        grid-column: 1 / -1 !important;
      }

      /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã•ã‚ŒãŸè¦ç´ ï¼ˆç‰¹å®šã®äºˆå®šãªã©ï¼‰ã®è£…é£¾ */
      .is-focus {
        grid-column: span 2; /* 2åˆ—åˆ†ã®å¹…ã‚’å æœ‰ã™ã‚‹ */
        background-color: #f0f4ff !important; /* èƒŒæ™¯è‰²ã‚’è–„ã„é’ã« */
      }

      /* æ—¥ä»˜1æ—¥åˆ†ã®ã‚«ãƒ¼ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³ */
      .day-card {
        box-sizing: border-box; /* ã‚µã‚¤ã‚ºè¨ˆç®—ã‚’å®‰å®šã•ã›ã‚‹ */
        background: white; /* ã‚«ãƒ¼ãƒ‰èƒŒæ™¯ */
        border-radius: 12px; /* è§’ä¸¸ */
        padding: 12px; /* å†…å´ã®ä½™ç™½ */
        min-height: 260px; /* æœ€ä½ã®é«˜ã•ã‚’ç¢ºä¿ */
        height: auto; /* ä¸­èº«ãŒå¢—ãˆã‚Œã°è‡ªå‹•ã§ä¼¸ã³ã‚‹ */
        display: flex; /* ä¸­èº«ã‚’æ•´åˆ—ã•ã›ã‚‹ */
        flex-direction: column; /* ä¸­èº«ã‚’ç¸¦ã«ä¸¦ã¹ã‚‹ */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05); /* è»½ã„å½± */
        position: relative; /* ã€Œä»Šæ—¥ã€ãƒ©ãƒ™ãƒ«ãªã©ã®é…ç½®åŸºæº– */
        border-top: 6px solid #eee; /* ã‚«ãƒ¼ãƒ‰ä¸Šéƒ¨ã®è‰²ä»˜ããƒãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¯ã‚°ãƒ¬ãƒ¼ï¼‰ */
      }

      /* ã€Œä»Šæ—¥ã€ã®ã‚«ãƒ¼ãƒ‰ã‚’å¼·èª¿ã™ã‚‹è¨­å®š */
      .is-today {
        outline: 3px solid #7a82f0; /* å¤–å´ã«é’ã„æ ç·š */
        outline-offset: 2px; /* æ ç·šã¨ã‚«ãƒ¼ãƒ‰ã®é–“ã«éš™é–“ã‚’ä½œã‚‹ */
        z-index: 10; /* ä»–ã®ã‚«ãƒ¼ãƒ‰ã‚ˆã‚Šå‰é¢ã«å‡ºã™ */
      }

      /* ã€Œä»Šæ—¥ã€ã‚«ãƒ¼ãƒ‰ã®å·¦ä¸Šã«ãƒ©ãƒ™ãƒ«ã‚’è¡¨ç¤º */
      .is-today::after {
        content: "ä»Šæ—¥"; /* è¡¨ç¤ºã™ã‚‹æ–‡å­— */
        position: absolute; /* çµ¶å¯¾é…ç½® */
        top: -14px;
        left: 10px; /* ä½ç½®èª¿æ•´ */
        background: #7a82f0; /* ãƒ©ãƒ™ãƒ«èƒŒæ™¯è‰² */
        color: white; /* æ–‡å­—è‰² */
        font-size: 0.6rem; /* æ–‡å­—ã‚µã‚¤ã‚º */
        padding: 2px 6px; /* ãƒ©ãƒ™ãƒ«å†…ã®ä½™ç™½ */
        border-radius: 4px; /* ãƒ©ãƒ™ãƒ«ã®è§’ä¸¸ */
        font-weight: bold; /* å¤ªå­— */
        z-index: 20; /* ã•ã‚‰ã«å‰é¢ã¸ */
      }

      /* åœŸæ—¥ã‚„æœˆã®çŠ¶æ…‹ã«ã‚ˆã‚‹è‰²ã®å¤‰åŒ– */
      .is-sat .date-num,
      .is-sat .day-of-week {
        color: #4466ff;
      } /* åœŸæ›œæ—¥ï¼šé’ */
      .is-sun .date-num,
      .is-sun .day-of-week {
        color: #ff4444;
      } /* æ—¥æ›œæ—¥ï¼šèµ¤ */

      /* ã‚«ãƒ¼ãƒ‰ä¸Šéƒ¨ãƒãƒ¼ã®è‰²è¨­å®šï¼ˆæœˆã®æº€ã¡æ¬ ã‘ãªã©ï¼‰ */
      .waxing {
        border-top-color: #ffd700;
      } /* ä¸Šå¼¦ï¼šé‡‘ */
      .waning {
        border-top-color: #4169e1;
      } /* ä¸‹å¼¦ï¼šé’ */
      .new-moon-blue {
        border-top-color: #4169e1 !important;
      } /* æ–°æœˆï¼šæ¿ƒã„é’ */

      /* æ—¥ä»˜ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ï¼ˆæ•°å­—ã¨æ›œæ—¥ã®ä¸¦ã³ï¼‰ */
      .date-head {
        display: flex;
        justify-content: space-between; /* ä¸¡ç«¯ã«æŒ¯ã‚Šåˆ†ã‘ã‚‹ */
        align-items: baseline; /* æ–‡å­—ã®ä¸‹ç«¯ã‚’åˆã‚ã›ã‚‹ */
        margin-bottom: 5px;
        height: 25px;
      }

      .date-main {
        display: flex;
        align-items: baseline;
        gap: 4px;
      } /* æ—¥ä»˜ï¼‹æ›œæ—¥ã®ã‚»ãƒƒãƒˆ */
      .date-num {
        font-weight: bold;
        font-size: 1.1rem;
      } /* æ—¥ä»˜ã®æ•°å­— */
      .day-of-week {
        font-size: 0.8rem;
        font-weight: bold;
        color: #666;
      } /* æ›œæ—¥ã®æ–‡å­— */
      .moon-age {
        font-size: 0.7rem;
        color: #999;
      } /* æœˆé½¢ãªã©ã®è£œåŠ©æƒ…å ± */

      /* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ©ã‚¤ãƒ³ï¼šæ–°æœˆãƒ»æº€æœˆã®æ–‡å­—ã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã®æ¨ªä¸¦ã³è¨­å®š */
      .status-line {
        display: flex; /* æ¨ªä¸¦ã³ã«ã™ã‚‹ */
        align-items: center; /* å‚ç›´æ–¹å‘ã®ä¸­å¤®æƒãˆ */
        gap: 6px; /* è¦ç´ é–“ã®éš™é–“ */
        margin-bottom: 8px; /* ä¸‹æ–¹å‘ã®ä½™ç™½ */
        min-height: 1.2rem; /* é«˜ã•ã‚’ç¢ºä¿ã—ã¦ã‚¬ã‚¿ã¤ãã‚’é˜²æ­¢ */
      }

      /* ã€Œæ–°æœˆã€ãªã©ã®æœˆé½¢ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ–‡å­— */
      .egg-status {
        font-size: 0.75rem; /* å°ã•ã‚ã®æ–‡å­—ã‚µã‚¤ã‚º */
        color: #4169e1; /* ãƒ­ã‚¤ãƒ¤ãƒ«ãƒ–ãƒ«ãƒ¼ */
        font-weight: bold; /* å¤ªå­— */
        flex-shrink: 0; /* æ¨ªå¹…ãŒç‹­ã¾ã£ã¦ã‚‚æ–‡å­—ã‚’æ½°ã•ãªã„ */
        position: relative;
        top: -1px; /* å‘¨ã‚Šã®æ–‡å­—ã¨é«˜ã•ã‚’æƒãˆã‚‹ãŸã‚ã®å¾®èª¿æ•´ */
      }

      /* ãã®æ—¥ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹æ–‡ */
      .advice-text {
        font-size: 0.65rem; /* ã‹ãªã‚Šå°ã•ã‚ã®æ–‡å­— */
        color: #888; /* æ§ãˆã‚ãªã‚°ãƒ¬ãƒ¼ */
        line-height: 1.2; /* è¡Œé–“ã‚’è©°ã‚ã‚‹ */
      }

      /* ã‚·ãƒ•ãƒˆé¸æŠã‚¨ãƒªã‚¢ã®å¤–æ  */
      .shift-selector {
        background: #f8f9fa; /* è–„ã„ã‚°ãƒ¬ãƒ¼ã®èƒŒæ™¯ */
        padding: 5px; /* å†…å´ã®ä½™ç™½ */
        border-radius: 6px; /* è§’ä¸¸ */
        margin-bottom: 8px; /* ä¸‹æ–¹å‘ã®ä½™ç™½ */
        border: 1px solid #eee; /* è–„ã„å¢ƒç•Œç·š */
        display: flex; /* ä¸­ã®ãƒœã‚¿ãƒ³ã‚’ä¸¦ã¹ã‚‹ */
        flex-wrap: wrap; /* å¹…ãŒè¶³ã‚Šãªã„æ™‚ã¯æŠ˜ã‚Šè¿”ã™ */
        gap: 4px; /* ãƒœã‚¿ãƒ³åŒå£«ã®é–“éš” */
        height: 60px; /* å…¨ã¦ã®æ—¥ã§é«˜ã•ã‚’ä¸€å®šã«ã™ã‚‹ */
        overflow: hidden; /* 2æ®µã«åã¾ã‚‰ãªã„åˆ†ã¯éš ã™ */
        min-height: 60px; /* æœ€ä½ã®é«˜ã•ã‚’ç¢ºä¿ */
        align-content: flex-start; /* ä¸­èº«ã‚’ä¸Šã«è©°ã‚ã‚‹ */
        width: 100%; /* å¹…ã„ã£ã±ã„ */
        box-sizing: border-box; /* ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¹…ã«å«ã‚ã‚‹ */
      }

      /* å„ã‚·ãƒ•ãƒˆãƒœã‚¿ãƒ³ï¼ˆã‚¿ã‚°ï¼‰ */
      .shift-tag {
        font-size: 0.6rem; /* ã‹ãªã‚Šå°ã•ãªæ–‡å­— */
        color: #555; /* æ¿ƒã„ã‚ã®ã‚°ãƒ¬ãƒ¼ */
        background: #fff; /* ãƒœã‚¿ãƒ³èƒŒæ™¯ã¯ç™½ */
        border: 1px solid #ddd; /* æ ç·š */
        padding: 0 4px; /* å·¦å³ã®ã¿ä½™ç™½ */
        height: 16px; /* é«˜ã•ã‚’å›ºå®š */
        line-height: 16px; /* æ–‡å­—ã‚’å‚ç›´ä¸­å¤®ã« */
        border-radius: 3px; /* æ§ãˆã‚ãªè§’ä¸¸ */
        cursor: pointer; /* æŒ‡ãƒãƒ¼ã‚¯ */
        display: inline-flex; /* ä¸­èº«ã‚’ä¸­å¤®å¯„ã›ã«ã™ã‚‹ãŸã‚ */
        align-items: center;
        white-space: nowrap; /* æ”¹è¡Œã•ã›ãªã„ */
      }

      /* ã‚·ãƒ•ãƒˆãƒœã‚¿ãƒ³ãŒé¸æŠã•ã‚ŒãŸæ™‚ï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ï¼‰ */
      .shift-tag.active {
        background: #7a82f0; /* ãƒ¡ã‚¤ãƒ³ã®é’ç´«è‰²ã« */
        color: white; /* æ–‡å­—ã‚’ç™½ã« */
        border-color: #7a82f0;
      }

      /* å…¥åŠ›ãƒ»è¡¨ç¤ºã‚¨ãƒªã‚¢ã‚’åŒ…ã‚€ã‚³ãƒ³ãƒ†ãƒŠ */
      .editor-container {
        display: flex;
        gap: 8px;
        flex-grow: 1; /* ã‚«ãƒ¼ãƒ‰å†…ã§ä½™ã£ãŸç¸¦å¹…ã‚’ä½¿ã„åˆ‡ã‚‹ */
        height: auto;
        min-height: 130px;
        position: relative;
        z-index: 10;
      }
        
      /* å…¥åŠ›ã‚¨ãƒªã‚¢ã‚’åŒ…ã‚€ç¸¦ã®ç®±ï¼ˆã‚«ãƒ©ãƒ ï¼‰è¨­å®š */
      .edit-column {
        flex: 1; /* è¦ªè¦ç´ ï¼ˆ.editor-containerï¼‰ã®ä¸­ã§ä½™ã£ãŸå¹…ã‚’ã™ã¹ã¦ä½¿ã„åˆ‡ã‚‹ */
        position: relative; /* å­è¦ç´ ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã‚„çµ¶å¯¾é…ç½®ã®ãƒœã‚¿ãƒ³ãªã©ï¼‰ã®åŸºæº–ä½ç½®ã«ãªã‚‹ */
        display: flex; /* ä¸­ã®ã€Œè¡¨ç¤ºã‚¨ãƒªã‚¢ã€ã¨ã€Œå…¥åŠ›ã‚¨ãƒªã‚¢ã€ã‚’åˆ¶å¾¡ã—ã‚„ã™ãã™ã‚‹ */
        flex-direction: column; /* ä¸­èº«ã‚’ç¸¦æ–¹å‘ã«ä¸¦ã¹ã‚‹ */
        height: auto; /* å†…å®¹é‡ã«åˆã‚ã›ã¦é«˜ã•ãŒæŸ”è»Ÿã«å¤‰ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹ */
      }

      /* å…¥åŠ›æ¬„ï¼šè¡¨ç¤ºæ™‚ã¨å…¥åŠ›æ™‚ã®æ ç·šã‚’çµ±ä¸€ã—ã¦å¾®å‹•ã‚’é˜²æ­¢ */
      /* å…¥åŠ›æ¬„ã®å…±é€šè¨­å®šï¼šåˆ‡ã‚Šæ›¿ãˆæ™‚ã®ã‚¬ã‚¿ã¤ãã‚’é˜²æ­¢ */
      .display-area,
      .edit-area {
        width: 100%;
        font-size: 0.8rem;
        line-height: 1.5;
        padding: 6px;
        border-radius: 6px;
        box-sizing: border-box;
        min-height: 130px;
        border: 1px solid #eee; /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å¢ƒç•Œç·š */
      }

      /* è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã®ã‚¨ãƒªã‚¢ */
      .display-area {
        flex-grow: 1;
        background: #fafafa; /* ã»ã‚“ã®å°‘ã—ã‚°ãƒ¬ãƒ¼ */
        height: 100%;
        cursor: text; /* ãƒ†ã‚­ã‚¹ãƒˆãŒæ‰“ã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã‚«ãƒ¼ã‚½ãƒ« */
      }

      /* ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ï¼‰ */
      .edit-area {
        background: #fff;
        border: 1px solid #7a82f0; /* ç·¨é›†ä¸­ã¯é’ç´«ã®æ ç·šã«ã™ã‚‹ */
        outline: none; /* ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã®å¼·èª¿ç·šã‚’æ¶ˆã™ */
        white-space: pre-wrap; /* æ”¹è¡Œã‚’ãã®ã¾ã¾è¡¨ç¤º */
        display: none; /* æœ€åˆã¯éš ã—ã¦ãŠãï¼ˆJSã§åˆ‡ã‚Šæ›¿ãˆï¼‰ */
        resize: none; /* ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ã‚µã‚¤ã‚ºå¤‰æ›´ã‚’ç¦æ­¢ */
        overflow: hidden;
      }

      /* å„ã‚¿ã‚¹ã‚¯ä¸€è¡Œåˆ†ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */
      .task-item {
        display: flex; /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆã¾ãŸã¯è¨˜å·ï¼‰ã¨ãƒ†ã‚­ã‚¹ãƒˆã‚’æ¨ªä¸¦ã³ã« */
        align-items: flex-start; /* è¤‡æ•°è¡Œã«ãªã£ã¦ã‚‚ã€å…ˆé ­ã®è¨˜å·ãŒä¸Šã«å›ºå®šã•ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ */
        gap: 5px; /* è¨˜å·ã¨ãƒ†ã‚­ã‚¹ãƒˆã®é–“ã®éš™é–“ */
      }

      /* å®Œäº†ã—ãŸã‚¿ã‚¹ã‚¯ã®è£…é£¾ */
      .task-done {
        text-decoration: line-through; /* æ–‡å­—ã®ä¸Šã«æ‰“ã¡æ¶ˆã—ç·šã‚’å¼•ã */
        color: #bbb; /* æ–‡å­—è‰²ã‚’è–„ãã—ã¦ã€Œçµ‚ã‚ã£ãŸæ„Ÿã€ã‚’å‡ºã™ */
      }

      /* ä¿å­˜æ™‚ãªã©ã®é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
      .status-msg {
        font-size: 0.7rem;
        color: #2ecc71; /* æˆåŠŸã‚’ç¤ºã™ç·‘è‰² */
        text-align: center;
        height: 1em;
        margin-bottom: 10px;
        position: fixed; /* ç”»é¢ä¸‹ã«å›ºå®š */
        bottom: 10px;
        width: 100%;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <div class="title-area">
        <h1>
          ğŸŒ‘ ãƒ ãƒ¼ãƒ³ãƒœãƒ¼ãƒ‰ <span id="year-display" class="year-display"></span>
        </h1>
      </div>
      <div class="nav-console">
        <div class="jump-group">
          <select id="select-year" onchange="jumpToDate()"></select
          ><select id="select-month" onchange="jumpToDate()"></select>
        </div>
        <div class="controls">
          <button onclick="movePeriod(-15)">â—€ å‰ã®ãƒ•ã‚§ãƒ¼ã‚º</button>
          <button onclick="resetToToday()">ä»Šæ—¥ã«æˆ»ã‚‹</button>
          <button onclick="movePeriod(15)">æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º â–¶</button>
        </div>
        <div id="current-info" class="info"></div>
      </div>
    </div>
    <div id="status" class="status-msg"></div>
    <div id="planner" class="planner-grid"></div>

    <script type="module">
      // ã‚¯ãƒ©ã‚¦ãƒ‰ï¼ˆFirebaseï¼‰ã‚’å‹•ã‹ã™ãŸã‚ã®é­”æ³•ã®é“å…·ã‚’å€Ÿã‚Šã¦ãã¾ã™
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
      import {
        getFirestore,
        doc,
        setDoc,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

      // æ¥ç¶šå…ˆã®æƒ…å ±ï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä½æ‰€éŒ²ï¼‰
      const firebaseConfig = {
        apiKey: "AIzaSyBEE451bCNLV-Ty337LyZryFlZqqiN4mxo",
        authDomain: "moonboard-27ebf.firebaseapp.com",
        projectId: "moonboard-27ebf",
        storageBucket: "moonboard-27ebf.firebasestorage.app",
        messagingSenderId: "437383444283",
        appId: "1:437383444283:web:f2fab00c5e190b2ca9291e",
      };

      // ã‚¯ãƒ©ã‚¦ãƒ‰ã¨ã®é€šä¿¡ã‚’é–‹å§‹ã—ã¾ã™
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const docRef = doc(db, "data", "moon-board"); // ä¿å­˜å ´æ‰€ã®åå‰

      // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ä¸­ã§ä½¿ã†ã€Œè¨˜æ†¶ã€ç”¨ã®å¤‰æ•°ãŸã¡
      let cloudData = {}; // ã‚¯ãƒ©ã‚¦ãƒ‰ã‹ã‚‰å±Šã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚çš„ã«ã—ã¾ã£ã¦ãŠãç®±
      let isFirstLoad = true; // æœ€åˆã«ç”»é¢ã‚’é–‹ã„ãŸã¨ãã ã‘å‹•ã‹ã™ãŸã‚ã®åˆå›³
      let isEditing = false; // ã€è¶…é‡è¦ã€‘ä»Šã€ä½•ã‹ã‚’æ›¸ã„ã¦ã„ã‚‹æœ€ä¸­ã‹ã©ã†ã‹ï¼ˆè¿½è¨˜ä¸­ã®æ¶ˆå¤±ã‚’é˜²ãï¼ï¼‰
      const LUNAR_CYCLE = 29.53059; // æœˆãŒä¸€å‘¨ã™ã‚‹æ™‚é–“
      let currentBaseDate = new Date(); // ä»Šã€ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã®åŸºæº–ã«ã—ã¦ã„ã‚‹æ—¥ä»˜

      // ã‚¯ãƒ©ã‚¦ãƒ‰ã®ãƒ‡ãƒ¼ã‚¿ãŒæ›´æ–°ã•ã‚ŒãŸã‚‰ã€è‡ªå‹•çš„ã«å‹•ãç›£è¦–å½¹
      onSnapshot(docRef, (docSnap) => {
        if (docSnap.exists()) {
          cloudData = docSnap.data(); // å±Šã„ãŸæœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ç®±ã«å…¥ã‚Œã‚‹
          // â˜…è¿½è¨˜ä¸­ã«ç”»é¢ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œãªã„ã‚ˆã†ã€ã€Œç·¨é›†ä¸­ã€ã§ãªã„ã¨ãã ã‘è¡¨ç¤ºã‚’æ›´æ–°
          if (!isEditing) {
            render(); // ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’æãç›´ã™
          }
        }
        if (isFirstLoad) {
          isFirstLoad = false;
        }
      });

      // ã‚¯ãƒ©ã‚¦ãƒ‰ã«ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹é­”æ³•
      window.saveToCloud = async (key, value) => {
        cloudData[key] = value; // æ‰‹å…ƒã®ç®±ã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹
        await setDoc(docRef, cloudData); // ã‚¯ãƒ©ã‚¦ãƒ‰ã«ã€Œã“ã‚Œä¿å­˜ã—ã¨ã„ã¦ï¼ã€ã¨é€ã‚‹
        const s = document.getElementById("status");
        s.innerText = "ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ã—ã¾ã—ãŸï¼";
        setTimeout(() => {
          s.innerText = "";
        }, 1000); // 1ç§’å¾Œã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
      };

      window.setupSelectors = () => {
        const yearSel = document.getElementById("select-year");
        const monthSel = document.getElementById("select-month");
        const currentYear = new Date().getFullYear();
        for (let y = currentYear - 1; y <= currentYear + 3; y++)
          yearSel.add(new Option(y + "å¹´", y));
        for (let m = 0; m < 12; m++) monthSel.add(new Option(m + 1 + "æœˆ", m));
        updateSelectors();
      };

      // æœˆé½¢ï¼ˆæœˆã®æº€ã¡æ¬ ã‘å…·åˆï¼‰ã‚’è¨ˆç®—ã™ã‚‹å¼
      function getMoonAge(date) {
        const refDate = new Date("2026-02-17T12:00:00+09:00").getTime(); // åŸºæº–ã¨ãªã‚‹æ–°æœˆ
        const diffDays =
          (new Date(date).getTime() - refDate) / (1000 * 60 * 60 * 24); // åŸºæº–æ—¥ã‹ã‚‰ã®æ—¥æ•°
        let age = (29.3 + diffDays) % LUNAR_CYCLE; // ã‚ã¾ã‚Šã‚’è¨ˆç®—ã—ã¦ä»Šã®æœˆé½¢ã‚’å‡ºã™
        return age < 0 ? age + LUNAR_CYCLE : age;
      }

      // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ—¥ä»˜ã‚’å‹•ã‹ã™æ©Ÿèƒ½ãŸã¡
      // é¸ã‚“ã å¹´æœˆã«ã‚¸ãƒ£ãƒ³ãƒ—
      window.jumpToDate = () => {
        currentBaseDate = new Date(
          document.getElementById("select-year").value,
          document.getElementById("select-month").value,
          1,
        );
        render();
      };
      // 15æ—¥é€²ã‚€ã€ã¾ãŸã¯æˆ»ã‚‹
      window.movePeriod = (days) => {
        currentBaseDate.setDate(currentBaseDate.getDate() + days);
        updateSelectors();
        render();
      };
      // ã€Œä»Šæ—¥ã€ã«ä¸€ç™ºã§æˆ»ã‚‹
      window.resetToToday = () => {
        currentBaseDate = new Date();
        updateSelectors();
        render();
      };
      function updateSelectors() {
        document.getElementById("select-year").value =
          currentBaseDate.getFullYear();
        document.getElementById("select-month").value =
          currentBaseDate.getMonth();
      }

      function parseTasks(text) {
        if (!text) return "";
        return text
          .split("\n")
          .map((line, idx) => {
            const trimmed = line.trim();
            if (trimmed.startsWith("-")) {
              const isDone = trimmed.includes("[x]");
              const cleanText = trimmed.replace(/^-\s*(\[x\])?\s*/, "");
              return `<div class="task-item"><input type="checkbox" ${isDone ? "checked" : ""} onchange="toggleTask(this, ${idx})"> <span class="${isDone ? "task-done" : ""}">${cleanText}</span></div>`;
            }
            return `<div>${line || "&nbsp;"}</div>`;
          })
          .join("");
      }

      window.autoResize = (el) => {
        if (!el) return;
        el.style.height = "auto";
        const isTheme = el.placeholder && el.placeholder.includes("ãƒ†ãƒ¼ãƒ");
        const minHeight = isTheme ? 0 : 130;
        const newHeight = Math.max(minHeight, el.scrollHeight);
        el.style.height = newHeight + "px";
      };

      window.render = () => {
        const planner = document.getElementById("planner");
        planner.innerHTML = ""; // ä¸€æ—¦ç”»é¢ã‚’çœŸã£ã•ã‚‰ã«ã™ã‚‹

        // ï¼ˆä¸­ç•¥ï¼šæ–°æœˆã‚„æº€æœˆã‹ã‚‰é€†ç®—ã—ã¦é–‹å§‹æ—¥ã‚’æ±ºã‚ã‚‹è¨ˆç®—ï¼‰

        const today = new Date();
        const ageAtBase = getMoonAge(currentBaseDate);
        let startDate = new Date(currentBaseDate);

        // ãƒ•ã‚§ãƒ¼ã‚ºåˆ¤å®š
        const isWaxingPhase = ageAtBase >= 28 || ageAtBase < 13.6;
        if (isWaxingPhase) {
          let offset = ageAtBase < 20 ? ageAtBase : ageAtBase - LUNAR_CYCLE;
          startDate.setDate(currentBaseDate.getDate() - Math.round(offset));
        } else {
          startDate.setDate(
            currentBaseDate.getDate() - Math.round(ageAtBase - 13.6),
          );
        }
        startDate.setHours(12, 0, 0, 0);

        const startAge = getMoonAge(startDate);
        const startIsNew = startAge < 5 || startAge > 25;
        const phaseColor = startIsNew ? "#ffd700" : "#4169e1";

        // ãƒ˜ãƒƒãƒ€ãƒ¼æƒ…å ±æ›´æ–°
        document.getElementById("year-display").innerText =
          `${startDate.getFullYear()}å¹´`;
        document.getElementById("current-info").innerHTML =
          `ã‚µã‚¤ã‚¯ãƒ«èµ·ç‚¹: <strong>${startIsNew ? "æ–°æœˆ" : "æº€æœˆ"} (${startDate.getMonth() + 1}/${startDate.getDate()})</strong>`;

        // ãƒ†ãƒ¼ãƒã‚»ã‚¯ã‚·ãƒ§ãƒ³
        const phaseThemeKey = `theme_v25_${startDate.getFullYear()}${startDate.getMonth() + 1}${startDate.getDate()}`;
        const savedTheme = cloudData[phaseThemeKey] || "";
        const themeSection = document.createElement("div");
        themeSection.style.cssText = `grid-column: 1 / -1; background: #fff; padding: 20px; border-radius: 16px; margin-bottom: 20px; border-left: 10px solid ${phaseColor}; box-shadow: 0 4px 12px rgba(0,0,0,0.05);`;
        themeSection.innerHTML = `
            <div style="font-size: 0.75rem; color: ${phaseColor}; font-weight: bold; margin-bottom: 8px;">${startIsNew ? "ğŸŒ‘ NEW MOON" : "ğŸŒ• FULL MOON"} PHASE THEME</div>
            <textarea style="width: 100%; border: none; font-size: 1.4rem; font-weight: bold; outline: none; background: transparent; font-family: inherit; resize: none; overflow: hidden;" placeholder="ã“ã®2é€±é–“ã®ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›..." oninput="autoResize(this)" onblur="saveToCloud('${phaseThemeKey}', this.value)">${savedTheme}</textarea>
        `;
        planner.appendChild(themeSection);
        autoResize(themeSection.querySelector("textarea"));

        // ã‚¯ã‚ªãƒ¼ã‚¿ãƒ¼ï¼ˆä¸Šå¼¦ãƒ»ä¸‹å¼¦ï¼‰ã®è¨ˆç®—
        let closestDates = { start: startDate.toDateString(), quarter: null };
        let minDiffQ = 99;
        const targetQ = startIsNew ? 7.4 : 22.1;

        // 16æ—¥åˆ†ã€é †ç•ªã«ã‚«ãƒ¼ãƒ‰ã‚’ä½œã£ã¦ã„ããƒ«ãƒ¼ãƒ—ï¼ˆç¹°ã‚Šè¿”ã—ï¼‰
        for (let i = 0; i < 16; i++) {
          // ä»Šæ—¥ã¯ä½•æ—¥ï¼Ÿ
          const d = new Date(startDate);
          d.setDate(startDate.getDate() + i);
          // ä»Šæ—¥ã¯æœˆé½¢ã„ãã¤ï¼Ÿ
          const age = getMoonAge(d);
          const diffQ = Math.abs(age - targetQ);
          if (diffQ < minDiffQ) {
            minDiffQ = diffQ;
            closestDates.quarter = d.toDateString();
          }
        }

        // å„æ—¥ã®ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
        for (let i = 0; i < 16; i++) {
          const d = new Date(startDate);
          d.setDate(startDate.getDate() + i);
          const dString = d.toDateString();
          const age = getMoonAge(d);

          let eggLabel = "";
          let advice = "";
          const isStartFocus = dString === closestDates.start;
          const isQuarterFocus = dString === closestDates.quarter;

          // ğŸŒ• ç‰¹åˆ¥ãªæ—¥ï¼ˆæ–°æœˆãƒ»æº€æœˆãƒ»ä¸Šå¼¦ãƒ»ä¸‹å¼¦ï¼‰ãªã‚‰åå‰ã¨ã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’ä»˜ã‘ã‚‹
          if (isStartFocus) {
            if (startIsNew) {
              eggLabel = "ğŸŒ‘ æ–°æœˆ";
              advice = "è¨ˆç”»ã‚’ç«‹ã¦ã‚‹ãƒ»ã¯ã˜ã‚ã‚ˆã†";
            } else {
              eggLabel = "ğŸŒ• æº€æœˆ";
              advice = "ã§ããŸã“ã¨ã®ç¢ºèªãƒ»æŒ¯ã‚Šè¿”ã‚Šã‚’ã—ã‚ˆã†";
            }
          } else if (isQuarterFocus) {
            if (startIsNew) {
              eggLabel = "ğŸŒ“ ä¸Šå¼¦";
              advice = "å¢—ã‚„ã—ãŸã„ãƒ»å¸åã—ãŸã„ã“ã¨ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚ˆã†";
            } else {
              eggLabel = "ğŸŒ— ä¸‹å¼¦";
              advice = "æ¥æœŸã®ãŸã‚ã«æº–å‚™ãƒ»æƒé™¤ã—ã¦æ•´ãˆã‚ˆã†";
            }
          }

          const isFocus = isStartFocus || isQuarterFocus;
          const isNewMoonStrict = age <= 0.5 || age >= LUNAR_CYCLE - 0.1;
          const moonPhaseClass = isNewMoonStrict
            ? "new-moon-blue"
            : age < 14.7
              ? "waxing"
              : "waning";

          // åœŸæ—¥ã‚„ä»Šæ—¥ã«è‰²ã‚’ä»˜ã‘ã‚‹ãŸã‚ã®ã€Œã‚¿ã‚°ã€ã‚’æ±ºã‚ã‚‹
          const card = document.createElement("div");
          card.className = `day-card ${moonPhaseClass} ${dString === today.toDateString() ? "is-today" : ""} ${isFocus ? "is-focus" : ""} ${d.getDay() === 6 ? "is-sat" : d.getDay() === 0 ? "is-sun" : ""}`;

          const storageKey = `moon_v23_${d.getFullYear()}${d.getMonth() + 1}${d.getDate()}`;
          const shiftOptions =
            d.getDay() === 3
              ? ["15-18æ™‚ ã‚¹ãƒã‚¤ãƒ«"]
              : ["9:30-18:15", "9:30-15:30", "12:15-18:15", "12:00-18:00"];
          const savedShifts = cloudData[storageKey + "_shifts"] || [];
          let shiftHtml =
            `<div class="shift-selector">` +
            shiftOptions
              .map(
                (s) =>
                  `<span class="shift-tag ${savedShifts.includes(s) ? "active" : ""}" onclick="toggleShift(this, '${storageKey}', '${s}')">${s}</span>`,
              )
              .join("") +
            `</div>`;

          const valA = cloudData[storageKey + "_a"] || "";
          const valB = cloudData[storageKey + "_b"] || "";
          let editors = `<div class="edit-column"><div class="display-area" onclick="startEdit(this)">${parseTasks(valA)}</div><textarea class="edit-area" data-key="${storageKey + "_a"}" onblur="finishEdit(this)" oninput="autoResize(this)"></textarea></div>`;
          if (isFocus)
            editors += `<div class="edit-column"><div class="display-area" onclick="startEdit(this)">${parseTasks(valB)}</div><textarea class="edit-area" data-key="${storageKey + "_b"}" onblur="finishEdit(this)" oninput="autoResize(this)"></textarea></div>`;

          // ã‚·ãƒ•ãƒˆãƒœã‚¿ãƒ³ã‚„å…¥åŠ›æ¬„ã‚’åˆä½“ã•ã›ã¦ã€ç”»é¢ã«ãƒšã‚¿ãƒšã‚¿è²¼ã‚Šä»˜ã‘ã‚‹
          card.innerHTML = `
                <div class="date-head">
                    <div class="date-main"><span class="date-num">${d.getMonth() + 1}/${d.getDate()}</span><span class="day-of-week">(${["æ—¥", "æœˆ", "ç«", "æ°´", "æœ¨", "é‡‘", "åœŸ"][d.getDay()]})</span></div>
                    <div class="moon-age">æœˆé½¢ ${age.toFixed(1)}</div>
                </div>
                <div class="status-line">
                    <div class="egg-status">${eggLabel}</div>
                    ${advice ? `<div class="advice-text">${advice}</div>` : ""}
                </div>
                ${shiftHtml}
                <div class="editor-container">${editors}</div>`;
          planner.appendChild(card);
        }
      };

      // ã‚·ãƒ•ãƒˆãƒœã‚¿ãƒ³ï¼ˆ9:30ãªã©ï¼‰ã‚’ãƒãƒãƒãƒã™ã‚‹æ©Ÿèƒ½
      window.toggleShift = async (el, key, val) => {
        // 1. å€‹åˆ¥ã®ãƒœã‚¿ãƒ³ã®è‰²ã‚’ãã®å ´ã§ã™ãå¤‰ãˆã‚‹ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã¯å‹•ã‹ãªã„ï¼‰
        el.classList.toggle("active"); // 1. ãã®å ´ã§ãƒœã‚¿ãƒ³ã®è‰²ã‚’ã‚«ãƒãƒƒã¨å¤‰ãˆã‚‹

        // 2. ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™
        let saved = cloudData[key + "_shifts"] || [];
        const idx = saved.indexOf(val);
        if (idx > -1) saved.splice(idx, 1);
        else saved.push(val);
        // 3. ã€é‡è¦ã€‘ã€Œä»Šã„ã˜ã£ã¦ã‚‹ã‹ã‚‰ç”»é¢ã‚’å‹æ‰‹ã«æãç›´ã•ãªã„ã§ï¼ã€ã¨ã‚¬ãƒ¼ãƒ‰ã‚’ç«‹ã¦ã‚‹
        isEditing = true; // 2. ã€Œä»Šã„ã˜ã£ã¦ã‚‹ã‹ã‚‰ç”»é¢ã‚’å‹•ã‹ã•ãªã„ã§ã€ã¨åˆå›³ã‚’å‡ºã™

        // 4. è£ã§ä¿å­˜
        await saveToCloud(key + "_shifts", saved); // 3. è£å´ã§ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜

        // 5. ä¿å­˜ãŒçµ‚ã‚ã£ãŸã‚‰å°‘ã—ã—ã¦ã‚¬ãƒ¼ãƒ‰ã‚’å¤–ã™
        setTimeout(() => {
          isEditing = false;
        }, 1000); // 4. ã—ã°ã‚‰ãã—ã¦ã‹ã‚‰åˆå›³ã‚’ä¸‹ã‚ã™
      };

      // è¿½è¨˜ã—ã‚ˆã†ã¨ã‚¿ãƒƒãƒ—ã—ãŸã¨ãã®å‹•ã
      window.startEdit = (displayEl) => {
        isEditing = true; // ç·¨é›†ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹
        const editEl = displayEl.nextElementSibling; // éš ã‚Œã¦ã„ãŸå…¥åŠ›ç”¨ã®ç®±ã‚’å‡ºã™

        // ç¾åœ¨ã®è¡¨ç¤ºã‚¨ãƒªã‚¢ã®ã€Œå®Ÿéš›ã®é«˜ã•ã€ã‚’å–å¾—ã—ã¦ã€ç·¨é›†æ ã®åˆæœŸã®é«˜ã•ã«ã™ã‚‹
        const currentHeight = displayEl.offsetHeight;

        displayEl.style.display = "none"; // ãƒ¡ãƒ¢è¡¨ç¤ºã‚’æ¶ˆã™
        editEl.style.display = "block"; // å…¥åŠ›æ ã‚’å‡ºã™

        // ã€é‡è¦ã€‘ç¾åœ¨ã®é«˜ã•ã‹ã€æœ€ä½130pxã€ã©ã¡ã‚‰ã‹å¤§ãã„æ–¹ã‚’æ¡ç”¨ã™ã‚‹
        // å…¥åŠ›æ ã‚’ãƒ¡ãƒ¢ã®é•·ã•ã«åˆã‚ã›ã‚‹ï¼ˆè¿½è¨˜ã—ã‚„ã™ãã™ã‚‹ãŸã‚ï¼‰
        editEl.style.minHeight = Math.max(currentHeight, 130) + "px";

        // ã€é‡è¦ã€‘ç®±ã®ä¸­ã«ã€ä»Šã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã—ã£ã‹ã‚Šå…¥ã‚Œã‚‹
        const key = editEl.getAttribute("data-key");
        editEl.value = cloudData[key] || "";

        window.autoResize(editEl); // é•·ã•ã«åˆã‚ã›ã¦æ ã‚’ä¼¸ã°ã™
        editEl.focus(); // ã‚«ãƒ¼ã‚½ãƒ«ã‚’åˆã‚ã›ã‚‹
      };

      // ç·¨é›†ï¼ˆè¿½è¨˜ï¼‰ã‚’çµ‚ãˆãŸã¨ãã®å‹•ã
      window.finishEdit = async (editEl) => {
        const displayEl = editEl.previousElementSibling;
        const key = editEl.getAttribute("data-key");
        const val = editEl.value;

        await saveToCloud(key, val); // ã‚¯ãƒ©ã‚¦ãƒ‰ã«ä¿å­˜ï¼

        // å…¥åŠ›æ ã‚’éš ã—ã¦ã€ãã‚Œã„ã«æ•´ãˆãŸãƒ¡ãƒ¢ï¼ˆ parseTasks ï¼‰ã‚’è¡¨ç¤ºã™ã‚‹
        displayEl.innerHTML = parseTasks(val);
        displayEl.style.display = "block";
        editEl.style.display = "none";

        // ã€é‡è¦ã€‘æ¬¡ã®ç·¨é›†ã®ãŸã‚ã«ã€æœ€å°é«˜ã•ã‚’130pxã«æˆ»ã—ã¦ãŠã
        editEl.style.minHeight = "130px";

        // æœ€å¾Œã«åˆå›³ã‚’ä¸‹ã‚ã™
        setTimeout(() => {
          isEditing = false;
        }, 800);
      };

      window.toggleTask = async (cb, lineIdx) => {
        const editEl = cb.closest(".edit-column").querySelector("textarea");
        const lines = editEl.value.split("\n");
        lines[lineIdx] = cb.checked
          ? lines[lineIdx].replace(/^-/, "- [x]")
          : lines[lineIdx].replace(/-?\s*\[x\]\s*/, "- ");
        editEl.value = lines.join("\n");
        await saveToCloud(editEl.getAttribute("data-key"), editEl.value);
        cb.closest(".task-item")
          .querySelector("span")
          .classList.toggle("task-done");
      };

      setupSelectors();
    </script>
  </body>
</html>
